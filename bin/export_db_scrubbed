#!/usr/bin/env ruby

bin_dir = File.dirname(__FILE__)
cwd = Dir.pwd

abs_path = "#{cwd}/#{bin_dir}"
backup_dir="#{abs_path}/../data/whathood_db"

BACKUP_FILE="whathood_bak.sql"

puts "dumping database to #{BACKUP_FILE}"
cmd="pg_dump --no-owner --schema-only whathood > #{backup_dir}/whathood_schema.sql"

puts cmd

system cmd

cmd="pg_dump --no-owner --data-only whathood > #{backup_dir}/whathood_data.sql"

puts cmd

system cmd

puts "data dumperd to directory #{backup_dir}"
Dir.chdir backup_dir

time = Time.new
`git add -A`
`git commit -m "re-exported whathood sql created at #{time}"`
`git push`
