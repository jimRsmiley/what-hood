#!/usr/bin/env ruby


db_name = 'whathood'

dir = Dir.pwd

script_dir = "#{dir}/app/scripts/sql"

def run_sql_script(file,db_name)
    `sudo -u postgres psql --tuples-only --quiet #{db_name} -f #{file}`
end

def import_files(dir_str,db_name)
    files = Dir.glob(dir_str)
    files = files.sort
    files.each do |f|
        puts "processing #{f}"
        run_sql_script(f,db_name)
    end
end


import_files("#{script_dir}/whathood.function.*.sql",db_name)
import_files("#{script_dir}/whathood.view.*.sql",db_name)

puts "done"
#function run_sql_script {
#  echo 'running script ' $@
#  DBNAME=whathood
#  sudo -u postgres psql --tuples-only --quiet $DBNAME -f "$@"
#}

#export -f run_sql_script

#find $SCRIPT_DIR -name 'whathood.view.*' -exec bash -c 'run_sql_script "$0"' {} \;
#find $SCRIPT_DIR -name 'whathood.function.*' -exec bash -c 'run_sql_script "$0"' {} \;

