#!/usr/bin/env perl

use lib 'libs/perl';
use strict;
use warnings;
use Whathood::Utils;

my $DATA_DIR="data/whathood_db";

Whathood::Utils->check_run_as_root();
Whathood::Utils->prompt_user("warning: this will destroy the current db");
<STDIN>;

`su - postgres -c 'dropdb whathood'`;
`sudo su - postgres -c 'createuser --superuser whathood'`;
`sudo su - postgres -c 'createdb whathood'`;
`sudo su - postgres -c 'psql -c "CREATE EXTENSION postgis" whathood'`;

print "deleting previous data directory\n";
`rm -rf $DATA_DIR`;
print "cloning database data\n";
`mkdir -p $DATA_DIR`;
`sudo git clone https://github.com/jimRsmiley/whathood-data.git $DATA_DIR > /dev/null`;

print "importing data into database\n";
`sudo psql -U whathood < $DATA_DIR/whathood_sql/whathood_bak.sql 2>&1 > /dev/null`;

